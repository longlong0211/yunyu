<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<script src="../js/mui.min.js"></script>
		<script src="../js/template.js"></script>
		<script src="../js/zepto.1.1.6.js"></script>
		<style>
			html,body {
				background-color: #efeff4;
			}
			.title{
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
		</style>
	</head>
	<body>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<ul class="mui-table-view mui-table-view-chevron" id="mui-content">
				</ul>	
			</div>
			<script type="text/html" id="article-list">
				{{each list as buYun}}
				<li class="mui-table-view-cell">
					<a href="" class="mui-navigate-right">{{buYun.title}}</a>
				</li>
				{{/each}}
			</script>
		</div>
	</body>

	<script>
		var page = 1;
		var hasMore = true;
		mui.init({
				pullRefresh: {
					container: '#pullrefresh',
					up: {
				      	contentrefresh : "正在加载...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
				      	contentnomore:'没有更多数据了',
						callback: pullupRefreshUp
					}
				}
			});
		
		mui.plusReady(function(){
			initList();
		});
		
		function initList(){
			var body = {"page":page};
			 mui.ajax('http://192.168.199.224:8080/yun/index.json',{  
        			data:body,  
        			dataType:'json',  
        			type:'post',  
       			contentType:"application/x-www-form-urlencoded; charset=utf-8",  
        			timeout:60000,  
		        success:function(data){
						var html = template("article-list",data);
						$("#mui-content").append(html);
						//document.getElementById("mui-content").innerHTML = html;
						if(data.page==data.totalPage){
							hasMore = false;
							mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);//参数为true说明没有更多数据
							mui('#pullrefresh').pullRefresh().disablePullupToRefresh();
						}else{
							mui('#pullrefresh').pullRefresh().endPullupToRefresh(false);
							page++;
						}
						//wd.close();
					},  
		        error:function(xhr,type,errorThrown){  
		            mui.alert("<网络连接失败，请重新尝试一下>", "错误", "OK", null);  
		        }  
    			});  
		};
		//setTimeout是延迟执行，只执行一次，不是定时器
		//多次间断执行要用setInterval
		function pullupRefreshUp(){
			if(hasMore){
				initList();
			}
		}
	</script>
</html>